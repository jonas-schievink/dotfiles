#!/bin/bash

# Script to initialize an X11 session
# This is run in addition to `init-session` for X11 sessions, and should do any
# work required only on X11 but not on Wayland.

# Setup logging
LOGFILE=/tmp/INIT-DESKTOP-LOG
exec > "$LOGFILE"
exec 2>&1

echo
echo "init-x-desktop"
date

# Initialize generic desktop
init-desktop &

# "No Tears"
# Curiously, `-b` to daemonize compton doesn't work and gives GL errors
compton --no-fading-openclose &

# FIXME: Does unclutter work on Wayland? If not, get a replacement!
# Without -noevents, Chrome stops reacting to scroll events when the cursor is
# hidden.
# This still has a bug where occasionally the window focus jumps back to the
# where the (invisible) mouse is hovering over.
# Ideally, I'd expect a tool like unclutter to simply change the cursor to a
# transparent one instead of the weird stuff it's doing. Maybe this is possible
# on wayland?
#unclutter -idle 2 -noevents &

# Xmodmap is reconfiguring my Model M to use the right control key as the i3
# modifier (since it doesn't have a Super key).
xmodmap ~/.config/X11/Xmodmap

# Delay in milliseconds, repeat rate in Hz
xset r rate 220 40

redshift -l 52.283333:8.05 &

(sleep 60 && rm "$LOGFILE") &

